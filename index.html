<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Fake Betting Website</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .hidden { display: none; }
    h2, h3 { color: #333; }
    input, button { margin: 5px; padding: 5px; }
    .container { margin-bottom: 20px; }
    table, th, td { border: 1px solid #ccc; border-collapse: collapse; padding: 5px; }
  </style>
</head>
<body>
  <!-- Login Section -->
  <div id="loginSection" class="container">
    <h2>Login</h2>
    <form id="loginForm">
      <label for="username">Username: </label>
      <input type="text" id="username" required><br>
      <label for="password">Password: </label>
      <input type="password" id="password" required><br>
      <button type="submit">Login</button>
    </form>
    <p id="loginMessage" style="color:red;"></p>
  </div>

  <!-- Admin Dashboard -->
  <div id="adminDashboard" class="container hidden">
    <h2>Admin Dashboard</h2>
    <button id="logoutBtnAdmin">Logout</button>
    <h3>Manage Lines</h3>
    <form id="createLineForm">
      <input type="text" id="lineDescription" placeholder="New Line Description" required>
      <button type="submit">Create Line</button>
    </form>
    <div id="linesContainer"></div>
    <h3>Resolve Bets</h3>
    <button id="resolveBetsBtn">Resolve Unsettled Bets</button>
    <h3>All Bets</h3>
    <div id="betsContainer"></div>
  </div>

  <!-- Member Dashboard -->
  <div id="memberDashboard" class="container hidden">
    <h2>Member Dashboard</h2>
    <button id="logoutBtnMember">Logout</button>
    <h3>Place a New Bet</h3>
    <form id="placeBetForm">
      <label>Bet Amount: </label>
      <input type="number" step="0.01" id="betAmount" required><br>
      <p>Select 2 to 6 Lines:</p>
      <div id="availableLines"></div>
      <button type="submit">Place Bet</button>
    </form>
    <h3>Live Bets</h3>
    <div id="liveBetsContainer"></div>
    <h3>Past Bets</h3>
    <div id="pastBetsContainer"></div>
  </div>

  <script>
  // Global State and Multiplier Table
  let currentUser = null;
  const MULTIPLIERS = {
    2: 3,
    3: 7,
    4: 10,
    5: 12,
    6: 25
  };

  // Data Storage Keys in localStorage
  const LINES_KEY = 'betting_lines';
  const BETS_KEY = 'betting_bets';

  // Utility functions for data persistence using localStorage
  function loadData(key) {
    const data = localStorage.getItem(key);
    return data ? JSON.parse(data) : [];
  }
  
  function saveData(key, data) {
    localStorage.setItem(key, JSON.stringify(data));
  }
  
  // Initialize Data Arrays
  let lines = loadData(LINES_KEY);
  let bets = loadData(BETS_KEY);

  // Helper: Generate a unique ID for new items
  function generateId(collection) {
    if (collection.length === 0) return 1;
    return Math.max(...collection.map(item => item.id)) + 1;
  }
  
  // Admin Dashboard Refresh
  function refreshAdminDashboard() {
    // Render Lines
    const linesContainer = document.getElementById('linesContainer');
    if (lines.length === 0) {
      linesContainer.innerHTML = '<p>No lines available.</p>';
    } else {
      let html = '<table><tr><th>ID</th><th>Description</th><th>Outcome</th><th>Actions</th></tr>';
      lines.forEach(line => {
        html += `<tr>
                   <td>${line.id}</td>
                   <td>${line.description}</td>
                   <td>${line.outcome === null ? 'Pending' : (line.outcome ? 'Correct' : 'Incorrect')}</td>
                   <td>
                     <button onclick="updateLineOutcome(${line.id})">Set Outcome</button>
                     <button onclick="deleteLine(${line.id})">Delete</button>
                   </td>
                 </tr>`;
      });
      html += '</table>';
      linesContainer.innerHTML = html;
    }
    // Render All Bets
    const betsContainer = document.getElementById('betsContainer');
    if(bets.length === 0) {
      betsContainer.innerHTML = '<p>No bets placed.</p>';
    } else {
      let html = '<table><tr><th>ID</th><th>User</th><th>Amount</th><th>Lines</th><th>Status</th><th>Payout</th></tr>';
      bets.forEach(bet => {
        html += `<tr>
                   <td>${bet.id}</td>
                   <td>${bet.user}</td>
                   <td>${bet.betAmount}</td>
                   <td>${bet.selectedLines.join(', ')}</td>
                   <td>${bet.isSettled ? (bet.isWon ? 'Won' : 'Lost') : 'Pending'}</td>
                   <td>${bet.payout ? bet.payout : '-'}</td>
                 </tr>`;
      });
      html += '</table>';
      betsContainer.innerHTML = html;
    }
  }

  // Member Dashboard Refresh
  function refreshMemberDashboard() {
    // Render Available Lines (only lines with outcome === null)
    const availableLinesDiv = document.getElementById('availableLines');
    const availableLines = lines.filter(line => line.outcome === null);
    if (availableLines.length === 0) {
      availableLinesDiv.innerHTML = '<p>No available lines to bet on.</p>';
    } else {
      let html = '';
      availableLines.forEach(line => {
        html += `<label>
                  <input type="checkbox" name="lineCheckbox" value="${line.id}"/> ${line.description}
                 </label><br>`;
      });
      availableLinesDiv.innerHTML = html;
    }
    // Render Live Bets (not settled)
    const liveBetsContainer = document.getElementById('liveBetsContainer');
    const liveBets = bets.filter(bet => bet.user === currentUser && !bet.isSettled);
    if(liveBets.length === 0){
      liveBetsContainer.innerHTML = '<p>No live bets.</p>';
    } else {
      let html = '<table><tr><th>ID</th><th>Amount</th><th>Lines</th><th>Placed On</th></tr>';
      liveBets.forEach(bet => {
        html += `<tr>
                   <td>${bet.id}</td>
                   <td>${bet.betAmount}</td>
                   <td>${bet.selectedLines.join(', ')}</td>
                   <td>${bet.createdAt}</td>
                 </tr>`;
      });
      html += '</table>';
      liveBetsContainer.innerHTML = html;
    }
    // Render Past Bets (settled)
    const pastBetsContainer = document.getElementById('pastBetsContainer');
    const pastBets = bets.filter(bet => bet.user === currentUser && bet.isSettled);
    if(pastBets.length === 0){
      pastBetsContainer.innerHTML = '<p>No past bets.</p>';
    } else {
      let html = '<table><tr><th>ID</th><th>Amount</th><th>Lines</th><th>Status</th><th>Payout</th><th>Resolved On</th></tr>';
      pastBets.forEach(bet => {
        html += `<tr>
                   <td>${bet.id}</td>
                   <td>${bet.betAmount}</td>
                   <td>${bet.selectedLines.join(', ')}</td>
                   <td>${bet.isWon ? 'Won' : 'Lost'}</td>
                   <td>${bet.payout ? bet.payout : '-'}</td>
                   <td>${bet.resolvedAt ? bet.resolvedAt : '-'}</td>
                 </tr>`;
      });
      html += '</table>';
      pastBetsContainer.innerHTML = html;
    }
  }

  // Login Handling
  document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    // Hard-coded credentials: admin/admin and member/member
    if ((username === 'admin' && password === 'admin') || (username === 'member' && password === 'member')) {
      currentUser = username;
      document.getElementById('loginSection').classList.add('hidden');
      if (username === 'admin') {
        document.getElementById('adminDashboard').classList.remove('hidden');
        refreshAdminDashboard();
      } else {
        document.getElementById('memberDashboard').classList.remove('hidden');
        refreshMemberDashboard();
      }
    } else {
      document.getElementById('loginMessage').textContent = 'Invalid credentials.';
    }
  });

  // Logout Handling
  document.getElementById('logoutBtnAdmin').addEventListener('click', logout);
  document.getElementById('logoutBtnMember').addEventListener('click', logout);
  
  function logout() {
    currentUser = null;
    document.getElementById('loginSection').classList.remove('hidden');
    document.getElementById('adminDashboard').classList.add('hidden');
    document.getElementById('memberDashboard').classList.add('hidden');
    document.getElementById('loginForm').reset();
  }

  // Admin: Create a New Line
  document.getElementById('createLineForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const desc = document.getElementById('lineDescription').value.trim();
    if (desc !== '') {
      const newLine = {
        id: generateId(lines),
        description: desc,
        outcome: null
      };
      lines.push(newLine);
      saveData(LINES_KEY, lines);
      document.getElementById('lineDescription').value = '';
      refreshAdminDashboard();
    }
  });

  // Admin: Update Line Outcome via Prompt
  window.updateLineOutcome = function(lineId) {
    const outcome = prompt("Enter outcome for line " + lineId + " ('correct' or 'incorrect'):");
    if (outcome !== null) {
      const line = lines.find(l => l.id === lineId);
      if (line) {
        if (outcome.toLowerCase() === 'correct') {
          line.outcome = true;
        } else if (outcome.toLowerCase() === 'incorrect') {
          line.outcome = false;
        }
        saveData(LINES_KEY, lines);
        refreshAdminDashboard();
      }
    }
  };

  // Admin: Delete a Line
  window.deleteLine = function(lineId) {
    if (confirm("Are you sure you want to delete line " + lineId + "?")) {
      lines = lines.filter(l => l.id !== lineId);
      saveData(LINES_KEY, lines);
      refreshAdminDashboard();
    }
  };

  // Admin: Resolve Bets
  document.getElementById('resolveBetsBtn').addEventListener('click', function() {
    bets.forEach(bet => {
      if (!bet.isSettled) {
        // Get associated lines for this bet
        const associatedLines = lines.filter(line => bet.selectedLines.includes(line.id));
        // Only resolve if outcomes for all selected lines have been set
        if (associatedLines.length === bet.selectedLines.length &&
            associatedLines.every(line => line.outcome !== null)) {
          if (associatedLines.every(line => line.outcome === true)) {
            bet.isWon = true;
            let legs = bet.selectedLines.length;
            bet.payout = bet.betAmount * (MULTIPLIERS[legs] || 1);
          } else {
            bet.isWon = false;
            bet.payout = 0;
          }
          bet.isSettled = true;
          bet.resolvedAt = new Date().toLocaleString();
        }
      }
    });
    saveData(BETS_KEY, bets);
    refreshAdminDashboard();
    refreshMemberDashboard();
  });

  // Member: Place a Bet
  document.getElementById('placeBetForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const betAmount = parseFloat(document.getElementById('betAmount').value);
    const checkboxes = document.querySelectorAll('input[name="lineCheckbox"]:checked');
    if (checkboxes.length < 2) {
      alert("Select at least 2 lines.");
      return;
    }
    if (checkboxes.length > 6) {
      alert("You cannot select more than 6 lines.");
      return;
    }
    const selectedLineIds = Array.from(checkboxes).map(cb => parseInt(cb.value));
    const newBet = {
      id: generateId(bets),
      user: currentUser,
      betAmount: betAmount,
      selectedLines: selectedLineIds,
      isSettled: false,
      isWon: null,
      payout: null,
      createdAt: new Date().toLocaleString(),
      resolvedAt: null
    };
    bets.push(newBet);
    saveData(BETS_KEY, bets);
    document.getElementById('placeBetForm').reset();
    refreshMemberDashboard();
  });
  </script>
</body>
</html>
